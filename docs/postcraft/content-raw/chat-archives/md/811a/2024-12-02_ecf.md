# [Flexible JSON Array Sorting Processor](https://claude.ai/chat/811a8eb8-acd3-4b87-98b8-5bd35a3d4b6a)

ecff0b56-eebd-4369-b3f7-a3604098a1b9

 I'll provide an example of using custom comparators with the Sort processor.

<antArtifact identifier="test-sort-custom-comparator" type="application/vnd.ant.code" language="json" title="Test Sort Input File with Version Numbers">
{
    "packages": [
        {
            "name": "react",
            "version": "17.0.2",
            "dependencies": 15
        },
        {
            "name": "express",
            "version": "4.17.1",
            "dependencies": 30
        },
        {
            "name": "lodash",
            "version": "4.17.21",
            "dependencies": 0
        },
        {
            "name": "webpack",
            "version": "5.65.0",
            "dependencies": 45
        }
    ]
}
</antArtifact>

<antArtifact identifier="test-sort-custom-config" type="application/vnd.ant.code" language="turtle" title="Custom Sort Config">
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix trm: <http://purl.org/stuff/transmission/> .
@prefix t: <http://hyperdata.it/transmissions/> .

t:reader a trm:ServiceConfig ;
    trm:configKey t:reader ;
    trm:sourceFile "input/custom-01.json" ;
    trm:mediaType "application/json" .

t:sortConfig a trm:ServiceConfig ;
    trm:configKey t:sort ;
    trm:target "packages" ;
    trm:rule """{"key": "version", "comparator": "semver"}""" .

t:writer a trm:ServiceConfig ;
    trm:configKey t:writer ;
    trm:destinationFile "output/output-custom-01.json" .
</antArtifact>

<antArtifact identifier="test-sort-custom-simple" type="application/vnd.ant.code" language="javascript" title="Simple Implementation with Custom Comparator">
import FileReader from '../../processors/fs/FileReader.js'
import Sort from '../../processors/json/Sort.js'
import FileWriter from '../../processors/fs/FileWriter.js'

const config = {
    "simples": "true",
    "sourceFile": "input/custom-01.json",
    "destinationFile": "output/output-custom-01.json",
    "mediaType": "application/json",
    "target": "packages",
    "rule": {
        "key": "version",
        "comparator": "semver"
    }
}

async function runCustomSort() {
    var message = { "dataDir": "src/applications/test_sort/data" }

    // Initialize Sort processor with custom comparator
    const sort = new Sort(config)
    
    // Register semver comparator
    sort.registerComparator('semver', (a, b) => {
        const partsA = a.split('.')
        const partsB = b.split('.')
        
        for (let i = 0; i < 3; i++) {
            const numA = parseInt(partsA[i] || 0)
            const numB = parseInt(partsB[i] || 0)
            if (numA !== numB) {
                return numB - numA // descending order
            }
        }
        return 0
    })

    // Register dependency-weighted comparator
    sort.registerComparator('depWeight', (a, b) => {
        const weightA = Math.log(a + 1) * 10
        const weightB = Math.log(b + 1) * 10
        return weightB - weightA // descending order
    })

    const read = new FileReader(config)
    message = await read.process(message)

    // First sort by semver
    message = await sort.process(message)

    // Then sort by dependencies using custom message
    message.sort = {
        target: "packages",
        rule: {
            key: "dependencies",
            comparator: "depWeight"
        }
    }
    message = await sort.process(message)

    const write = new FileWriter(config)
    await write.process(message)
}

runCustomSort().catch(console.error)
</antArtifact>

<antArtifact identifier="test-sort-custom-required" type="application/vnd.ant.code" language="json" title="Expected Output for Custom Sort">
{
    "packages": [
        {
            "name": "webpack",
            "version": "5.65.0",
            "dependencies": 45
        },
        {
            "name": "react",
            "version": "17.0.2",
            "dependencies": 15
        },
        {
            "name": "lodash",
            "version": "4.17.21",
            "dependencies": 0
        },
        {
            "name": "express",
            "version": "4.17.1",
            "dependencies": 30
        }
    ]
}
</antArtifact>

This example demonstrates:

1. Custom semver comparator that properly sorts semantic version numbers
2. Dependency-weighted comparator using logarithmic scaling
3. Multi-pass sorting (first by version, then by dependencies)
4. Integration with framework configuration

Example comparator use via message:

```javascript
// Sort by version
message.sort = {
    target: "packages",
    rule: {
        key: "version",
        comparator: "semver"
    }
}

// Sort by weighted dependencies
message.sort = {
    target: "packages",
    rule: {
        key: "dependencies",
        comparator: "depWeight"
    }
}
```

q1: Would you like to see more specialized comparators (e.g., for geographical coordinates)?
q2: Should I add composite comparators that combine multiple criteria?
q3: Would you like to see locale-aware string comparison examples?
q4: Should I add caching for expensive comparisons?

---

* **sourceFile** : /home/danny/github-danny/hyperdata/docs/chat-archives/data-2025-01-25-12-45-58/conversations.json
* **appName** : claude-json-converter
* **appPath** : claude-json-converter
* **subtask** : [undefined]
* **rootDir** : /home/danny/github-danny/transmissions/src/applications/claude-json-converter
* **dataDir** : /home/danny/github-danny/transmissions/src/applications/claude-json-converter/data
* **targetPath** : /home/danny/github-danny/transmissions/src/applications/claude-json-converter/data
* **tags** : ccc10.ccc20.ccc30.ccc40.ccc50
* **done** : [undefined]
* **meta** : {
  "conv_uuid": "811a8eb8-acd3-4b87-98b8-5bd35a3d4b6a",
  "conv_name": "Flexible JSON Array Sorting Processor",
  "updated_at": "2024-12-02T00:06:26.447782Z"
}
* **filepath** : /home/danny/github-danny/hyperdata/docs/postcraft/content-raw/chat-archives/md/811a/2024-12-02_ecf.md